import requests


class MalwareCheck:
    def __init__(self, urls):
        self.api_key = 'AIzaSyBtbicSOdG8pd_f5aTZZSa_8EQ7PKeLPhs'
        self.url = "https://safebrowsing.googleapis.com/v4/threatMatches:find"
        self.urllist = list()
        self.malwarelist = list()
        for x in urls:
            obiect = dict()
            obiect['url'] = x
            self.urllist.append(obiect)
        self.payload = {'client': {'clientId': "mycompany", 'clientVersion': "0.1"},
                        'threatInfo': {'threatTypes': ["SOCIAL_ENGINEERING", "MALWARE"],
                                       'platformTypes': ["ANY_PLATFORM"],
                                       'threatEntryTypes': ["URL"],
                                       'threatEntries': self.urllist}}
        self.params = {'key': self.api_key}
        self.r = requests.post(self.url, params=self.params, json=self.payload)
        if self.r.json() != '':
            malware = self.r.json()
            try:
                if malware['matches']:
                    for x in range(0, len(malware['matches'])):
                        self.malwarelist.append(malware['matches'][x]['threat']['url'])
            except KeyError:
                pass
